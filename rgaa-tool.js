function getFigCaption(element){if(element.parentElement===null)return null;if(element.nodeName.toLowerCase()==="figcaption")return null;if(element.nodeName.toLowerCase()!=="figure"){return getFigCaption(element.parentElement)}const figCaption=element.querySelector("figcaption");if(figCaption===null)return null;return removeLineReturn(figCaption.innerText)}function convertSize(width,height,maxWidth,maxHeight){const rx=maxWidth/width;const ry=maxHeight/height;const ratio=Math.min(rx,ry);return[width*ratio,height*ratio]}function createDataThumbnail(src,maxWidth,maxHeight,callback){const image=new Image;image.crossOrigin="Anonymous";image.onload=function(){const canvas=document.createElement("canvas");const context=canvas.getContext("2d");const[width,height]=convertSize(this.naturalWidth,this.naturalHeight,maxWidth,maxHeight);canvas.width=width;canvas.height=height;context.drawImage(this,0,0,width,height);const dataURL=canvas.toDataURL("image/png");callback(dataURL,width,height)};image.src=src}function extractImages(){const elements=document.createDocumentFragment();const title=document.createElement("h1");title.innerText="Images";elements.appendChild(title);const table=document.createElement("table");table.classList.add("images-table");const images=document.querySelectorAll("img");for(let image of images){let row=document.createElement("tr");if(isHidden(image)){row.classList.add("is-hidden")}else{row.classList.add("is-visible")}let content=document.createElement("td");content.classList.add("image-content");let div=document.createElement("div");content.appendChild(div);createDataThumbnail(image.getAttribute("src"),150,150,(dataURL,width,height)=>{const thumbnail=document.createElement("img");thumbnail.setAttribute("src",dataURL);thumbnail.setAttribute("width",width);thumbnail.setAttribute("height",height);div.appendChild(thumbnail)});row.appendChild(content);let alt=document.createElement("td");alt.classList.add("image-alt");let altValue=image.getAttribute("alt");if(altValue===null){alt.innerText="‚ùé"}else if(altValue.trim()===""){alt.innerText="empty alt";alt.classList.add("is-hidden")}else{alt.innerText=altValue}row.appendChild(alt);let figCaption=document.createElement("td");figCaption.classList.add("image-figcaption");let figCaptionValue=getFigCaption(image);if(figCaptionValue===null){figCaption.innerText="no figcaption";figCaption.classList.add("is-hidden")}else{figCaption.innerText=figCaptionValue}row.appendChild(figCaption);table.appendChild(row)}elements.appendChild(table);return elements}function createPopup(fragment,styles){const copyTab=window.open("","_blank","popup").document;copyTab.title="RGAA Tool";const encoding=document.createElement("meta");encoding.setAttribute("charset","UTF-8");copyTab.head.appendChild(encoding);copyTab.head.appendChild(styles);copyTab.body.appendChild(fragment);copyTab.close()}function removeLineReturn(string){if(string===null)return null;return string.replace(/( *(\r\n|\n|\r) *)+/gm,"\n").trim().replace(/(.)\n(.)/gm,"$1. $2")}function getText(element){const text=removeLineReturn(element.innerText);if(text)return text;const image=element.querySelector("img[alt]");if(image&&image.getAttribute("alt").trim()!==""){return"üñº "+image.getAttribute("alt")}const title=removeLineReturn(element.getAttribute("title"));if(title)return"üÜé";return"‚ùé"}const styles=`[[[CSS:src/style.css]]]`;function getStyles(){const style=document.createElement("style");style.innerText=styles;return style}function isHidden(element){const styles=window.getComputedStyle(element);const hidden=styles.display==="none"||styles.visibility==="hidden";if(element.parentElement===null){return hidden}else if(!hidden){return isHidden(element.parentElement)}else{return true}}function extractLinks(){const elements=document.createDocumentFragment();const title=document.createElement("h1");title.innerText="Links";elements.appendChild(title);const links=document.getElementsByTagName("a");const table=document.createElement("table");table.classList.add("links-table");for(let link of links){if(link.href==="")continue;let row=document.createElement("tr");if(isHidden(link)){row.classList.add("is-hidden")}else{row.classList.add("is-visible")}let text=document.createElement("td");text.classList.add("link-text");text.innerText=getText(link);row.appendChild(text);let title=document.createElement("td");title.classList.add("link-title");if(link.title.trim()){title.innerText=link.title}else{title.innerText="no title";title.classList.add("is-hidden")}row.appendChild(title);let href=document.createElement("td");href.classList.add("link-href");href.innerText=link.href;row.appendChild(href);table.appendChild(row)}elements.appendChild(table);return elements}const levels={h1:0,h2:1,h3:2,h4:3,h5:4,h6:5};function buryInUL(level,element){if(!(level in levels))return element;let parent;for(let step=0;step<levels[level];step++){parent=document.createElement("ul");parent.appendChild(element);element=parent}return element}function extractHeadings(){const elements=document.createDocumentFragment();const title=document.createElement("h1");title.innerText="Headings";elements.appendChild(title);const headingElements=document.createElement("ul");headingElements.classList.add("heading-list");const headings=document.querySelectorAll("h1,h2,h3,h4,h5,h6");for(let heading of headings){let element=document.createElement("li");element.innerText=getText(heading);element=buryInUL(heading.nodeName.toLowerCase(),element);element.classList.add(heading.nodeName);if(isHidden(heading)){element.classList.add("is-hidden")}else{element.classList.add("is-visible")}headingElements.appendChild(element)}elements.appendChild(headingElements);return elements}function scrollSlowlyTillTheEnd(previous,delay,final){const current=window.pageYOffset;if(current===previous){final()}else{window.scrollBy(0,window.innerHeight);setTimeout(()=>{scrollSlowlyTillTheEnd(current,delay,final)},delay)}}window.scrollTo(0,0);scrollSlowlyTillTheEnd(-1,200,()=>{const elements=document.createDocumentFragment();elements.appendChild(extractLinks());elements.appendChild(extractHeadings());elements.appendChild(extractImages());createPopup(elements,getStyles());window.scrollTo(0,0)});
